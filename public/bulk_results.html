<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Bulk Results</title>
  <style>
    .post { border: 1px solid #ccc; margin-bottom: 10px; padding: 10px; }
    .actions button { margin-right: 5px; }
  </style>
</head>
<body>
  <h1>Scheduled Posts</h1>
  <div id="message"></div>
  <div id="posts"></div>
  <script>
    const postsDiv = document.getElementById('posts');
    const messageDiv = document.getElementById('message');
    let posts = [];

    async function loadPosts() {
      try {
        messageDiv.textContent = 'Loading posts...';
        const res = await fetch('https://ofem.onrender.com/api/scheduled-posts');
        if (!res.ok) throw new Error('Failed to load scheduled posts');
        const data = await res.json();
        posts = Array.isArray(data.posts) ? data.posts.map((p) => ({
          image: p.image_url || '',
          caption: p.caption || '',
          date: p.schedule_time ? new Date(p.schedule_time).toLocaleString() : '',
          status: p.status || 'pending'
        })) : [];
        messageDiv.textContent = `Loaded ${posts.length} scheduled post(s).`;
      } catch (err) {
        messageDiv.textContent = 'Unable to load posts from server.';
        posts = [];
      }
      renderPosts();
    }

    function renderPosts() {
      postsDiv.innerHTML = '';
      if (posts.length === 0) {
        postsDiv.innerHTML = '<p>No scheduled posts.</p>';
        return;
      }
      posts.forEach((post, index) => {
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `
          <img src="${post.image}" alt="image" style="max-width:200px;"><br>
          <strong>Caption:</strong> ${post.caption}<br>
          <strong>Scheduled for:</strong> <span id="date-${index}">${post.date}</span><br>
          <strong>Status:</strong> ${post.status || 'pending'}<br>
          <div class="actions">
            <button onclick="editDate(${index})">Edit Date/Time</button>
            <button onclick="deletePost(${index})">Delete</button>
            <button onclick="sendNow(${index})">Send Now</button>
          </div>
        `;
        postsDiv.appendChild(div);
      });
    }

    function editDate(index) {
      const newDate = prompt('Enter new date and time:', posts[index].date);
      if (newDate) {
        posts[index].date = newDate;
        renderPosts();
      }
    }

    function deletePost(index) {
      if (confirm('Delete this post?')) {
        posts.splice(index, 1);
        renderPosts();
      }
    }

    async function sendNow(index) {
      try {
        messageDiv.textContent = 'Sending...';
        // Placeholder for sending logic
        posts.splice(index, 1);
        renderPosts();
        messageDiv.textContent = 'Post sent successfully!';
      } catch (err) {
        messageDiv.textContent = 'Error sending post.';
      }
    }

    loadPosts();
  </script>
</body>
</html>
